<div class="row-fluid">

	<div class='span8'>
		<h1>Elovation Games</h1>
		<%= link_to "New Game", new_game_path, class: "btn btn-primary" %>

		<ul id='games-list'>
		<% Game.all.sort_by(&:name).each do |game| %>
		  <li class="<%= "active" if @game == game %> game-list-item">
		    <%= link_to game_path(game) do %>
		    	<h3 class='game-title'><%= game.name %></h3>
		    	<ul class='game-params'>
  		    	<li class='rating-type'><%= game.rating_type %> â€“ <%= game.allow_ties ? 'Ties allowed' : 'No ties' %></li>
            <li class='num-players'><%= game.players.length %> players</li>
            <li class='games-played'><%= game.results.length %> games played</li>

		    	</ul>

          <% result = game.recent_results.limit(1).first %>
          <% if result %>
            <div class='recent-result'>
              <h4>Last game</h4>
              <div class='description'>

                <% result.teams.each_with_index do |team, i| %>
                  <% team.players.each do |winner| %>
                    <span class='player'>
                      <strong><%= winner.name %></strong>
                    </span>
                  <% end %>
                  <% if i == 0 %>
                    defeated
                  <% end %>
                <% end %>
                <br/>
                <time><%= format_time(result.created_at) %></time>
              </div>
            </div>
          <% end %>


		    <% end %>
		  </li>
		<% end %>
		</ul>
	</div>

	<div class='span4'>
		<div class='well'>
			<h2>Players</h2>

			<table id='players-list'>
				<thead>
					<tr>
						<th> <%= link_to "New Player", new_player_path, class: "btn" %> </th>
						<th>
							<%= link_to "New Flair", new_flair_path, class: "btn" %>
							<%= link_to "All Flairs", flairs_path, class: "btn" %>
						</th>
					</tr>
				</thead>
				<tbody>
				<% Player.all.sort_by(&:name).each do |player| %>
					<tr>
						<td class="player <%= "active" if @player == player %>">
							<%= link_to player_path(player) do %>
								<%= image_tag(gravatar_url(player, size: 24)) %>
								<%= player.name %>
							<% end %>
						</td>
						<td>
							<%= render partial: 'flairs/flair', object: player.flair %>
						</td>
					</tr>
				<% end %>
				</tbody>
			</table>
		</div>
	</div>

</div>
